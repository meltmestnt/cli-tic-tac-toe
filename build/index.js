(()=>{"use strict";var e={n:t=>{var l=t&&t.__esModule?()=>t.default:()=>t;return e.d(l,{a:l}),l},d:(t,l)=>{for(var r in l)e.o(l,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:l[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=require("react");var l=e.n(t);const r=require("ink"),n=(e,t)=>{const l=Math.sqrt(e.length),r=t%l;return[...Array(l)].map(((t,n)=>e[n*l+r]))},s=e=>{const t=Math.sqrt(e.length);let l=[];for(let r=0;r<t;r++)l.push(e.slice(t*r,t*(r+1))),l.push(n(e,r));return l.push([...Array(t)].map(((l,r)=>0===r?e[r]:e[r*t+r]))),l.push([...Array(t)].map(((l,r)=>e[r*t-(r-(t-1))]))),l},a=e=>{let t=Math.round(Math.random()*e.length-1);return e[t]?.symbol&&(t=a(e)),t},i=(e,t,l)=>t.find(((t,r,n)=>{const s=t.filter((e=>e.symbol===l));return!(s.length!==Math.sqrt(e.length)-1||!t.filter((e=>!s.includes(e)&&!e.symbol)).length)})),o=(e,t)=>{let l;const r=i(e,t,"x"),n=i(e,t,"o");if(n){const e=n.find(((e,t)=>!e.symbol))?.id;e&&(l=e)}else if(r){const e=r.find(((e,t)=>!e.symbol))?.id;e&&(l=e)}return l&&"o"===e[l]?.symbol&&(l=o(e,t.filter((e=>e!==r)))),l},c=require("figures");var u=e.n(c);const m=require("ink-big-text");var d=e.n(m);u().cross,u().circle;const g=({cells:e,handleEndGame:i,disabled:c})=>{const[u,m]=(0,t.useState)(((e=3)=>[...Array(e*e)].map(((e,t)=>({id:t,symbol:null}))))(e)),[g,f]=(0,t.useState)(0),[h,E]=(0,t.useState)("x");(0,t.useEffect)((()=>{const e=(e=>{let t=null,l=s(e);return t=["x","o"].find((e=>l.find((t=>t.every((t=>t.symbol===e))))))||null,t})(u);e?i(e):u.every((e=>!!e.symbol))&&i("draw")}),[u]);const b=(e,t,l)=>{if(t[e]?.symbol||e<0){let r;if(Array.isArray(l))r=l.slice(0,l.findIndex((t=>t.id===e))).find((e=>!e.symbol))?.id??l.slice().reverse().find((e=>!e.symbol))?.id;else for(let l=e;l>=0;l--)if(!t[l]?.symbol){r=l;break}e=r??b(t.length-1,t)}return e},x=(e,t,l)=>{if(t[e]?.symbol||e>t.length-1){let r;if(Array.isArray(l))r=l.slice(l.findIndex((t=>t.id===e)),l.length-1).find((e=>!e.symbol))?.id??l.find((e=>!e.symbol))?.id;else for(let l=e;l<t.length;l++)if(!t[l]?.symbol){r=l;break}e=r??x(0,t)}return e},y={leftArrow:()=>{f((t=>{let l=t-1;return l=b(l,u),l<0&&(l=e*e-1),l}))},rightArrow:()=>{f((t=>{let l=t+1;return l=x(l,u),l>e*e-1&&(l=0),l}))},upArrow:()=>{f((t=>{let l=t-e;l>e*e-1?l-=e*e:l<0&&(l=e*e+l);const r=n(u,l);return l=b(l,u,r),l}))},downArrow:()=>{f((t=>{let l=t+e;l>e*e-1?l-=e*e:l<0&&(l=e*e+l);const r=n(u,l);return l=x(l,u,r),l}))},return:()=>{m((e=>{if(e[g].symbol)return e;let t=e.map(((e,t)=>t===g?{...e,symbol:e.symbol??h}:e));const l=(e=>{let t=s(e),l=a(e);const r=o(e,t);return r&&(l=r),l})(t);return t=t.map(((e,t)=>t===l?{...e,symbol:e.symbol??"x"===h?"o":"x"}:e)),t}))}};return(0,r.useInput)(((e,t)=>{c||Object.keys(y).forEach((e=>{t[e]&&y[e]()}))})),l().createElement(r.Box,{flexGrow:1,flexDirection:"column",padding:2},u.reduce(((t,l,r,n)=>(0!==r&&(r+1)%e==0&&t.push(n.slice(r-(e-1),r+1)),t)),[]).map(((e,t)=>l().createElement(r.Box,null,e.map((({id:n,symbol:s},a)=>l().createElement(r.Box,{key:n,flexGrow:1,flexShrink:0,flexBasis:0,padding:1,flexDirection:"column",alignItems:"center",justifyContent:"flex-start",borderStyle:"classic",height:6,borderColor:g===a+t*e.length?"yellowBright":"whiteBright"},l().createElement(r.Box,{marginTop:-2},l().createElement(d(),{font:"tiny",text:s??""})))))))))},f={messages:[],handleChangeMessages:()=>{}},h=(0,t.createContext)(f),E=({children:e})=>{const[r,n]=(0,t.useState)([]);return l().createElement(h.Provider,{value:{messages:r,handleChangeMessages:e=>{n(e)}}},e)},b=()=>{const{messages:e,handleChangeMessages:l}=(0,t.useContext)(h);return{messages:e,handleChangeMessages:l}},x=e=>!isNaN(+e)&&!isNaN(parseFloat(e.toString()));function y(){return y=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var l=arguments[t];for(var r in l)Object.prototype.hasOwnProperty.call(l,r)&&(e[r]=l[r])}return e},y.apply(this,arguments)}const p=({children:e,...t})=>l().createElement(r.Box,{alignItems:"center",justifyContent:"flex-start"},l().createElement(r.Text,{color:"green"},u().questionMarkPrefix," "),l().createElement(r.Text,y({color:"whiteBright",bold:!0},t),e)),v=({children:e,...t})=>l().createElement(r.Box,{marginX:.2},l().createElement(r.Text,{color:"blueBright"},e)),S=({onChange:e,cellsSize:t})=>((0,r.useInput)(((t,l)=>{x(t)?e((e=>e+t)):l.backspace&&e((e=>e.slice(0,e.length-1)))})),l().createElement(r.Box,{justifyContent:"center",flexDirection:"column"},l().createElement(p,null,"How many cells do you want in grid?"),l().createElement(v,null,t))),w=({item:e,autoFocus:t=!1,isActive:n,disabled:s})=>{let a={};const{isFocused:i}=(0,r.useFocus)({autoFocus:t,isActive:!s,id:e.id.toString()});return(void 0===n&&i||n)&&(a={color:"yellow",inverse:!0}),l().createElement(r.Box,{alignItems:"center",paddingLeft:.5},l().createElement(r.Text,{color:n?"yellowBright":"whiteBright",bold:!0},u().pointer," "),l().createElement(r.Text,a,e.label))},B=({items:e,label:n,handleSelectItem:s,disabled:a,defaultValue:i})=>{let o=null;Array.isArray(e)&&e.length&&(o=i?e.find((e=>e.value===i))?.id:e[0]?.id);const[c,m]=(0,t.useState)(o??null),{enableFocus:d,focusNext:g,focusPrevious:f,focus:h}=(0,r.useFocusManager)();return(0,t.useEffect)((()=>{d()}),[]),(0,r.useInput)(((t,l)=>{if(a)return;const r=e.findIndex((e=>e.id===c));if(l.upArrow){const t=r-1;let l=(t<0?e[e.length-1]?.id:e[t]?.id)||e[0]?.id;if(!l)return;m(l),h(l.toString())}else if(l.downArrow){const t=r+1;let l=(t>e.length-1?e[0]?.id:e[t]?.id)||e[e.length-1]?.id;if(!l)return;m(l),h(l.toString())}else if(l.return||l.rightArrow){const t=e.find((e=>e.id===c));if(!t)return;if(t.onSelect)return t.onSelect(t);s(t)}})),l().createElement(r.Box,{flexDirection:"column"},l().createElement(r.Box,{alignItems:"center"},l().createElement(r.Text,{color:"magentaBright",bold:!0},u().pointer," "),l().createElement(r.Text,null,n)),e.map(((e,t)=>l().createElement(w,{disabled:a,key:e.id,isActive:c===e.id,autoFocus:0===t,item:e}))))},M=[{id:1,label:"3x3",value:"3"},{id:2,label:"4x4",value:"4"},{id:3,label:"5x5",value:"5"}],C=({onChange:e,handleStartGame:n,cellsSize:s,isGameStarted:a})=>{const[i,o]=(0,t.useState)(!1),{handleChangeMessages:c}=b(),{isRawModeSupported:u}=(0,r.useStdin)();(0,r.useInput)(((e,t)=>{if(i&&t.return){if(!s)return c([{level:"error",message:"Grid size should be defined."}]);if(+s>10)return c([{level:"error",message:"Maximum grid size is 10."}]);if(+s<3)return c([{level:"error",message:"Minimum grid size is 3."}]);s&&x(s)&&n()}}));const m=t=>e(t),d=[...M];return u&&d.push({id:4,value:"",label:"Custom grid size",onSelect:()=>{o(!0)}}),l().createElement(l().Fragment,null,l().createElement(B,{items:d,handleSelectItem:e=>{m(e.value),n()},label:"Available grid sizes",disabled:i||a}),i&&u&&l().createElement(S,{cellsSize:s,onChange:m}))},I=require("ink-gradient");var A=e.n(I);const T={error:l().createElement(r.Text,{color:"redBright",bold:!0},u().cross),success:l().createElement(r.Text,{color:"greenBright",bold:!0},u().tick),info:l().createElement(r.Text,{color:"yellowBright",bold:!0},u().arrowRight)},k=({message:e})=>{const{level:t,message:n}=e,s=T[t];return l().createElement(r.Box,{paddingLeft:.5,alignItems:"center"},s||null,l().createElement(r.Text,null," "),l().createElement(r.Text,{color:"whiteBright",bold:!0},n))};let G;!function(e){e.SINGLE="SINGLE",e.MULTI="MULTI"}(G||(G={}));const L=[{id:1,label:"Single (vs AI)",value:G.SINGLE},{id:2,label:"Multi (vs player)",value:G.MULTI}],F=({handleChangeGameMode:e,gameMode:t})=>l().createElement(B,{items:L,handleSelectItem:t=>{e(t.value)},label:"Choose game mode",defaultValue:t}),j="SELECT_CELLS",z="SELECT_GAME_MODE",P=()=>{const[e,n]=(0,t.useState)(""),[s,a]=(0,t.useState)(!1),[i,o]=(0,t.useState)(null),{handleChangeMessages:c}=b(),[u,m]=(0,t.useState)(),f=(0,t.useRef)(0);(0,t.useEffect)((()=>{c(e?e=>e.filter((e=>e.id!==j)):e=>[...e,{id:j,message:"Please select grid size",level:"info"}])}),[e]),(0,t.useEffect)((()=>{c(u?e=>e.filter((e=>e.id!==z)):e=>[...e,{id:z,message:"Please select game mode",level:"info"}])}),[u]);(0,r.useInput)(((e,t)=>{i&&s&&(t.return?(a(!0),f.current=f.current+1,o(null)):t.escape&&(a(!1),o(null)))}));const h=[];return u||h.push(l().createElement(F,{gameMode:u,handleChangeGameMode:e=>{m(e)}})),u&&!e&&h.push(l().createElement(C,{key:1,isGameStarted:s,onChange:e=>{n(e)},handleStartGame:()=>{o(null),a(!0),c([])},cellsSize:e})),s&&e&&h.push(l().createElement(r.Box,{key:2,position:"relative"},l().createElement(g,{cells:+e,handleEndGame:e=>{c([{level:"success",message:["x","o"].includes(e)?`Winner is ${e}`:"Friendship won"}]),e&&o(e)},disabled:!!i,key:f.current}),i&&l().createElement(r.Box,{width:"100%",height:"100%",justifyContent:"center",alignItems:"center",position:"absolute"},"draw"===i?l().createElement(d(),{colors:["red"],text:"Draw"}):l().createElement(A(),{name:"rainbow"},l().createElement(d(),{text:`Winner is ${i}!`}))))),s&&i&&h.push(l().createElement(r.Box,{key:3,flexDirection:"column"},[{level:"info",message:'Press "Enter" to continue'},{level:"info",message:'Press "Esc" to continue'}].map((e=>l().createElement(k,{message:e}))))),l().createElement(l().Fragment,null,h)},q=()=>{const{messages:e}=b();return l().createElement(r.Box,{marginY:1,flexDirection:"column"},l().createElement(r.Text,{bold:!0,inverse:!0,color:"blue"},"Current status:"),e.map((e=>l().createElement(k,{message:e}))))},O=()=>l().createElement(E,null,l().createElement(q,null),l().createElement(P,null));(0,r.render)(l().createElement(O,null))})();